<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Bot - Earn & Watch</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- Telegram Theme Variables (Dynamic Colors) --- */
        :root {
            --bg-color: #f0f0f0;
            --text-color: #000000;
            --secondary-bg-color: #ffffff;
            --hint-color: #707070;
            --link-color: #007aff;
            --success-color: #4CAF50;
            --danger-color: #FF6B6B;
        }

        body.tg-theme {
            --bg-color: var(--tg-theme-bg-color, #f0f0f0);
            --text-color: var(--tg-theme-text-color, #000000);
            --secondary-bg-color: var(--tg-theme-secondary-bg-color, #ffffff);
            --hint-color: var(--tg-theme-hint-color, #707070);
            --link-color: var(--tg-theme-link-color, #007aff);
        }

        /* --- Base Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            min-height: 100vh;
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 15px;
        }

        /* --- Top Navigation Bar (Telegram-style Segmented Control) --- */
        .top-nav {
            display: flex;
            background-color: var(--secondary-bg-color);
            padding: 4px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .nav-btn {
            flex-grow: 1;
            background: none;
            border: none;
            color: var(--hint-color);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 0;
            border-radius: 8px;
            transition: background 0.2s, color 0.2s;
        }

        .nav-btn.active {
            background-color: var(--link-color);
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* --- Main Content Sections --- */
        .section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Card Styles --- */
        .card {
            background-color: var(--secondary-bg-color);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        /* --- Balance Card (Image 1000008770.jpg Style) --- */
        .balance-card {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); /* Gold/Orange Gradient */
            color: white;
            text-align: center;
            padding: 25px 15px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.4);
        }

        .balance-amount {
            font-size: 38px;
            font-weight: 900;
            margin: 5px 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .balance-amount i {
            font-size: 28px;
            margin-right: 10px;
        }

        .progress-text {
            font-size: 14px;
            margin-top: 5px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.3);
            height: 10px;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--success-color); /* Bright Green */
            height: 100%;
            width: 3.23%; /* Initial value, will be set by JS */
            border-radius: 5px;
            transition: width 0.5s ease-out;
        }

        /* --- Spin Wheel Section --- */
        .spin-section {
            text-align: center;
        }
        
        .spin-wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 30px auto;
        }

        .spin-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                #FF6B6B 0% 12.5%, #FFA726 12.5% 25%, #FFEE58 25% 37.5%, #66BB6A 37.5% 50%, 
                #42A5F5 50% 62.5%, #5C6BC0 62.5% 75%, #AB47BC 75% 87.5%, #FF6B6B 87.5% 100%
            );
            transition: transform 5s cubic-bezier(0.25, 0.1, 0, 1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .spin-center {
            width: 100px;
            height: 100px;
            background: var(--secondary-bg-color);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--text-color);
            cursor: pointer;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 5px solid var(--bg-color);
        }

        .spin-center small {
            font-size: 12px;
            font-weight: normal;
            color: var(--hint-color);
        }

        .spin-indicator {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate(-50%, -15px);
            width: 0; 
            height: 0; 
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 15px solid var(--link-color);
        }
        
        /* --- Invitation Section --- */
        .referral-link {
            background-color: var(--bg-color);
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
            font-size: 14px;
            color: var(--text-color);
            text-align: center;
        }

        .share-buttons {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 15px;
        }

        .share-btn {
            background-color: var(--link-color);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            flex-grow: 1;
        }

        .users-list {
            max-height: 250px;
            overflow-y: auto;
            padding: 5px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            background-color: var(--bg-color);
        }

        .user-earned {
            color: var(--success-color);
            font-weight: bold;
        }
        
        /* --- Withdrawal Section --- */
        .withdrawal-card .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .withdrawal-card .info-item {
            background-color: var(--bg-color);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .withdrawal-card .info-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--link-color);
        }
        
        .withdrawal-card .info-label {
            font-size: 12px;
            color: var(--hint-color);
        }
        
        /* --- Form Styles --- */
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--hint-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

    </style>
</head>
<body class="tg-theme">
    <div class="container">
        <div class="top-nav">
            <button class="nav-btn active" data-section-id="spin" onclick="showSection('spin', this)">üèÜ Rank</button>
            <button class="nav-btn" data-section-id="invite" onclick="showSection('invite', this)">üë• Invitation</button>
            <button class="nav-btn" data-section-id="cashout" onclick="showSection('cashout', this)">üí∞ Cash Out</button>
            <button class="nav-btn" data-section-id="groups" onclick="showSection('groups', this)">üé¨ Movies</button>
        </div>

        <div id="spin" class="section active">
            <div class="spin-section">
                <div class="balance-card">
                    <div style="font-size: 16px;">Your Balance</div>
                    <div class="balance-amount">‚Çπ<span id="currentBalance">3.23</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 3.23%;"></div>
                    </div>
                    <div class="progress-text">Only ‚Çπ<span id="remainingToCashout">96.77</span> left to cash out ‚Çπ100!</div>
                </div>

                <div class="spin-wheel-container">
                    <div class="spin-indicator"></div>
                    <div id="spinWheel" class="spin-wheel">
                        <div class="spin-center" onclick="spinWheel()">
                            <span id="spinCount">0</span>
                            <small>Spins</small>
                        </div>
                    </div>
                </div>

                </div>
        </div>

        <div id="invite" class="section">
            <div class="invite-section">
                <div class="card">
                    <h3>üë• Invite Friends & Earn</h3>
                    <p style="color: var(--hint-color); margin-bottom: 10px;">Get ‚Çπ0.20 for each successful invite.</p>
                    
                    <div class="info-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="info-item" style="background-color: var(--bg-color);">
                            <div class="info-value" id="totalInvites">0</div>
                            <div class="info-label">Total Invites</div>
                        </div>
                        <div class="info-item" style="background-color: var(--bg-color);">
                            <div class="info-value" style="color: var(--success-color);">‚Çπ<span id="inviteEarnings">0.00</span></div>
                            <div class="info-label">Earned</div>
                        </div>
                    </div>

                    <div class="referral-link" id="referralLinkDisplay">
                        Loading...
                    </div>
                    
                    <button class="share-btn" onclick="copyReferralLink()" style="margin-bottom: 10px; background-color: var(--link-color);">
                         <i class="fas fa-copy"></i> Copy Link
                    </button>

                    <div class="share-buttons">
                        <button class="share-btn" onclick="shareToTelegram()" style="background-color: #0088CC;"><i class="fab fa-telegram-plane"></i></button>
                        <button class="share-btn" onclick="shareToWhatsApp()" style="background-color: #25D366;"><i class="fab fa-whatsapp"></i></button>
                        <button class="share-btn" onclick="shareToOther()" style="background-color: var(--hint-color);"><i class="fas fa-share-alt"></i></button>
                    </div>
                </div>

                <div class="card">
                    <h4>Invited Users (Active Today)</h4>
                    <div class="users-list" id="invitedUsers">
                        <div class="user-item">
                            <div><strong>@exampleuser1</strong></div>
                            <div class="user-earned">+‚Çπ0.20</div>
                        </div>
                        <div class="user-item">
                            <div><strong>@exampleuser2</strong></div>
                            <div class="user-earned">+‚Çπ0.20</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="cashout" class="section">
            <div class="withdrawal-section">
                <div class="card withdrawal-card">
                    <h3>üí∞ Withdrawal Summary</h3>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-value">‚Çπ<span id="toBeCashed">0.00</span></div>
                            <div class="info-label">Current Balance</div>
                        </div>
                        <div class="info-item">
                            <div class="info-value" style="color: var(--success-color);">‚Çπ<span id="successWithdrawal">0.00</span></div>
                            <div class="info-label">Total Withdrawn</div>
                        </div>
                        <div class="info-item">
                            <div class="info-value" style="color: var(--hint-color);">‚Çπ<span id="underReview">0.00</span></div>
                            <div class="info-label">Under Review</div>
                        </div>
                        <div class="info-item">
                            <div class="info-value" id="availableSpins" style="color: var(--danger-color);">3</div>
                            <div class="info-label">Remaining Spins</div>
                        </div>
                    </div>

                    <p style="text-align: center; color: var(--hint-color); font-size: 14px;">Minimum cashout amount is ‚Çπ100.</p>
                </div>

                <div class="card" id="withdrawalForm">
                    <h4>üí≥ Payment Details (For Cashout)</h4>
                    <p style="color: var(--link-color); text-align: center; margin-bottom: 15px;">Admin Contact: <a href="https://t.me/{YOUR_TELEGRAM_HANDLE}" target="_blank">@{YOUR_TELEGRAM_HANDLE}</a></p>
                    
                    <div class="form-group">
                        <label class="form-label">Account Name / UPI Name</label>
                        <input type="text" class="form-input" id="accountName" placeholder="Full name of account holder">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">UPI ID (Preferred)</label>
                        <input type="text" class="form-input" id="upiId" placeholder="e.g., example@paytm">
                    </div>

                    <div style="border-top: 1px solid var(--bg-color); padding-top: 15px; margin-top: 15px;">
                        <label class="form-label" style="font-weight: bold;">(Optional) Bank Account Details</label>
                        <div class="form-group">
                            <input type="text" class="form-input" id="accountNumber" placeholder="Account Number (Optional)">
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-input" id="ifscCode" placeholder="IFSC Code (Optional)">
                        </div>
                    </div>
                    
                    <button class="share-btn" id="submitWithdrawalBtn" style="width: 100%; margin-top: 15px; background-color: var(--success-color);" onclick="submitWithdrawal()">
                        Submit Details & Notify Admin
                    </button>
                </div>
            </div>
        </div>
        
        <div id="groups" class="section">
            <div class="card">
                <h3>üé¨ Movie Group Links</h3>
                <p style="color: var(--hint-color);">Join our Telegram groups to get your favourite movies instantly!</p>
            </div>
            
            <div class="movie-groups" style="display: grid; gap: 10px;">
                <button class="group-btn card" style="text-align: left; cursor: pointer; background-color: var(--secondary-bg-color);" onclick="openMovieGroup('new')">
                    <strong>üÜï New Movie Group (Fastest)</strong>
                    <div style="font-size: 12px; color: var(--hint-color);">Get all the latest releases here.</div>
                </button>
                <button class="group-btn card" style="text-align: left; cursor: pointer; background-color: var(--secondary-bg-color);" onclick="openMovieGroup('main')">
                    <strong>üìö Main Movie Group</strong>
                    <div style="font-size: 12px; color: var(--hint-color);">Our primary group for all users.</div>
                </button>
                <button class="group-btn card" style="text-align: left; cursor: pointer; background-color: var(--secondary-bg-color);" onclick="openMovieGroup('all')">
                    <strong>üîó Join All Groups List</strong>
                    <div style="font-size: 12px; color: var(--hint-color);">A single link to join our full collection of groups.</div>
                </button>
            </div>
        </div>
        
    </div>

    <script>
        // Placeholder for the Bot's Web Server URL
        const API_BASE_URL = 'YOUR_WEB_SERVER_URL'; 
        const BOT_HANDLE = 'YOUR_TELEGRAM_HANDLE';
        const MIN_CASHOUT_AMOUNT = 100;
        
        let tg = null;
        let currentUser = null;
        let userData = {
            balance: 3.23, // in INR
            totalEarnings: 0,
            totalInvites: 0,
            invitedUsers: [
                { name: '@user_a', joinDate: 'Today' },
                { name: '@user_b', joinDate: 'Today' }
            ],
            availableSpins: 3,
            totalWithdrawal: 0,
            underReviewWithdrawal: 0
        };
        
        const MOVIE_GROUP_LINKS = {
            'new': 'https://t.me/Susanllll_bot/app?startapp=NzMxNTgwNTU4MV83ODU2NjkwMTgz',
            'main': 'https://t.me/asfilter_group',
            'all': 'https://t.me/addlist/EOSX8n4AoC1jYWU1'
        };

        // --- Core Functions ---

        function initTelegramApp() {
            tg = window.Telegram.WebApp;
            tg.expand();
            tg.ready();
            
            currentUser = tg.initDataUnsafe.user;
            
            // Apply Telegram Theme Colors
            document.body.classList.add('tg-theme');
            document.documentElement.style.setProperty('--link-color', tg.themeParams.button_color);
            document.documentElement.style.setProperty('--bg-color', tg.themeParams.bg_color);
            document.documentElement.style.setProperty('--text-color', tg.themeParams.text_color);
            document.documentElement.style.setProperty('--secondary-bg-color', tg.themeParams.secondary_bg_color);
            
            // Set Admin handle in form
            document.querySelector('#withdrawalForm a').href = `https://t.me/${BOT_HANDLE}`;
            document.querySelector('#withdrawalForm a').textContent = `@${BOT_HANDLE}`;


            loadUserData(); // Fetch initial data
            showSection('spin', document.querySelector('.nav-btn.active')); // Show default section and set main button
        }

        async function loadUserData() {
            // Placeholder: In a real app, this would fetch user data from your Python backend
            // const response = await fetch(`${API_BASE_URL}/api/user-data`, { /*...*/ });
            // userData = await response.json();
            
            // Update the referral link with the actual bot handle and user ID
            const botUsername = 'your_bot_username'; // Replace with actual bot username
            const referralLink = `https://t.me/${botUsername}?start=ref_${currentUser.id}`;
            document.getElementById('referralLinkDisplay').textContent = referralLink;
            
            updateUI();
        }

        function updateUI() {
            // Update Balance and Progress
            const balanceINR = userData.balance;
            const remaining = MIN_CASHOUT_AMOUNT - balanceINR;
            const progressPercent = Math.min((balanceINR / MIN_CASHOUT_AMOUNT) * 100, 100);

            document.getElementById('currentBalance').textContent = balanceINR.toFixed(2);
            document.getElementById('remainingToCashout').textContent = remaining.toFixed(2);
            document.querySelector('.progress-fill').style.width = progressPercent.toFixed(2) + '%';
            
            // Update Spin/Invite/Withdrawal Data
            document.getElementById('spinCount').textContent = userData.availableSpins;
            document.getElementById('totalInvites').textContent = userData.totalInvites;
            document.getElementById('inviteEarnings').textContent = (userData.totalInvites * 0.20).toFixed(2);
            document.getElementById('toBeCashed').textContent = balanceINR.toFixed(2);
            document.getElementById('successWithdrawal').textContent = userData.totalWithdrawal.toFixed(2);
            document.getElementById('underReview').textContent = userData.underReviewWithdrawal.toFixed(2);
            document.getElementById('availableSpins').textContent = userData.availableSpins;

            // Update Spin Center Text
            const spinCenter = document.querySelector('.spin-center');
            spinCenter.innerHTML = `
                <span id="spinCount">${userData.availableSpins}</span>
                <small>Spins</small>
            `;

            // Update Invited Users List
            updateInvitedUsersList();
            
            // Update Main Button for current section
            const activeSectionId = document.querySelector('.section.active').id;
            updateMainButton(activeSectionId);
        }

        function updateMainButton(sectionId) {
            tg.MainButton.hide();
            tg.MainButton.offClick(spinWheel);
            tg.MainButton.offClick(submitWithdrawal);
            
            if (sectionId === 'spin') {
                tg.MainButton.setText('‚ûï GET +1 SPIN');
                if (userData.availableSpins > 0) {
                    tg.MainButton.show();
                    tg.MainButton.enable();
                    tg.MainButton.onClick(spinWheel);
                } else {
                    tg.MainButton.setText('Invite Friends for more Spins');
                    tg.MainButton.disable();
                    tg.MainButton.show();
                }
            } else if (sectionId === 'cashout') {
                tg.MainButton.setText(`CASH OUT ‚Çπ${MIN_CASHOUT_AMOUNT}`);
                if (userData.balance >= MIN_CASHOUT_AMOUNT) {
                    tg.MainButton.show();
                    tg.MainButton.enable();
                    tg.MainButton.onClick(submitWithdrawal);
                } else {
                    tg.MainButton.setText(`Need ‚Çπ${(MIN_CASHOUT_AMOUNT - userData.balance).toFixed(2)} More`);
                    tg.MainButton.disable();
                    tg.MainButton.show();
                }
            }
        }


        // --- Navigation and View Functions ---

        function showSection(sectionId, element) {
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if(element) {
                element.classList.add('active');
            } else {
                document.querySelector(`.nav-btn[data-section-id="${sectionId}"]`).classList.add('active');
            }
            
            // Show section
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            updateMainButton(sectionId);
        }

        // --- Spin Wheel Logic ---

        async function spinWheel() {
            if (userData.availableSpins <= 0) {
                tg.showAlert('No Spins Left! Invite friends to get more spins.');
                return;
            }

            const spinWheelElement = document.getElementById('spinWheel');
            const winningAngle = 360 * 10 + 22.5; // Example angle for a win (can be randomized from backend)
            
            // Lock UI
            tg.MainButton.disable();
            tg.MainButton.setText('Spinning...');
            
            // Spin Animation
            spinWheelElement.style.transform = `rotate(${winningAngle}deg)`;
            tg.HapticFeedback.impactOccurred('light');

            // Simulate API call for result
            await new Promise(resolve => setTimeout(resolve, 5000));
            
            // Reset CSS transition and rotate back to a neutral position for next spin
            spinWheelElement.style.transition = 'none';
            spinWheelElement.style.transform = `rotate(${winningAngle % 360}deg)`;
            setTimeout(() => {
                spinWheelElement.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0, 1)';
            }, 50);

            // Simulate result
            const earnedAmount = 0.50; // Replace with actual API result
            userData.balance += earnedAmount;
            userData.availableSpins -= 1;
            tg.HapticFeedback.notificationOccurred('success');
            
            tg.showAlert(`Congratulations! You won ‚Çπ${earnedAmount.toFixed(2)}!`);
            
            updateUI();
        }

        // --- Invitation Functions ---

        function shareToTelegram() {
            const link = document.getElementById('referralLinkDisplay').textContent;
            const text = `Join this amazing movie bot and earn money! ${link}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`);
        }

        function shareToWhatsApp() {
            const link = document.getElementById('referralLinkDisplay').textContent;
            const text = `Join this amazing movie bot and earn money! ${link}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        function copyReferralLink() {
            const link = document.getElementById('referralLinkDisplay').textContent;
            navigator.clipboard.writeText(link).then(() => {
                tg.showPopup({ title: 'Copied!', message: 'Referral link copied to clipboard', buttons: [{ type: 'ok' }] });
                tg.HapticFeedback.notificationOccurred('success');
            });
        }

        function shareToOther() {
            const link = document.getElementById('referralLinkDisplay').textContent;
            const text = `Join this amazing movie bot and earn money! ${link}`;
            
            if (navigator.share) {
                navigator.share({ title: 'Movie Bot', text: text, url: link });
            } else {
                copyReferralLink();
            }
        }

        function updateInvitedUsersList() {
            const usersList = document.getElementById('invitedUsers');
            usersList.innerHTML = '';

            if (userData.invitedUsers.length === 0) {
                usersList.innerHTML = `<div style="text-align: center; color: var(--hint-color); padding: 10px;">No active invites today.</div>`;
                return;
            }

            userData.invitedUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div>
                        <strong>${user.name}</strong>
                    </div>
                    <div class="user-earned">+‚Çπ0.20</div>
                `;
                usersList.appendChild(userItem);
            });
        }

        // --- Movie Group Functions ---
        function openMovieGroup(type) {
            tg.openTelegramLink(MOVIE_GROUP_LINKS[type]);
        }

        // --- Withdrawal Functions ---

        async function submitWithdrawal() {
            if (userData.balance < MIN_CASHOUT_AMOUNT) {
                tg.showAlert(`Cashout failed. Minimum amount is ‚Çπ${MIN_CASHOUT_AMOUNT}.`);
                return;
            }
            
            const formData = {
                accountName: document.getElementById('accountName').value.trim(),
                upiId: document.getElementById('upiId').value.trim(),
                accountNumber: document.getElementById('accountNumber').value.trim(),
                ifscCode: document.getElementById('ifscCode').value.trim()
            };

            // Basic validation
            if (!formData.accountName || (!formData.upiId && !formData.accountNumber)) {
                tg.showAlert('Please enter your Account Name and either a UPI ID or Bank Account Number.');
                return;
            }
            
            // Lock UI
            tg.MainButton.disable();
            tg.MainButton.setText('Submitting...');
            
            // 1. Prepare message for Admin
            const adminMessage = `
                üí∞ **NEW WITHDRAWAL REQUEST**
                
                **User:** ${currentUser.full_name} (@${currentUser.username || 'N/A'})
                **User ID:** \`${currentUser.id}\`
                **Amount:** ‚Çπ${userData.balance.toFixed(2)}
                
                **--- Payment Details ---**
                **Name:** ${formData.accountName}
                **UPI ID:** ${formData.upiId || 'N/A'}
                **A/C No.:** ${formData.accountNumber || 'N/A'}
                **IFSC:** ${formData.ifscCode || 'N/A'}
            `;

            // 2. Open Chat with Admin (for user to send the message)
            const botChatUrl = `https://t.me/${BOT_HANDLE}?start=withdrawal_request_${currentUser.id}`;
            tg.openTelegramLink(botChatUrl);

            // 3. Inform the user and reset local balance (Optimistic Update - should be confirmed by API)
            tg.showAlert('Withdrawal request submitted! Please send your payment details to the admin in the chat that just opened.');

            // Placeholder for API call to move balance to 'Under Review'
            // userData.underReviewWithdrawal += userData.balance;
            // userData.balance = 0;
            // updateUI();
            
            // Re-enable button after action
            tg.MainButton.enable();
            tg.MainButton.setText(`CASH OUT ‚Çπ${MIN_CASHOUT_AMOUNT}`); // Reset button text

            tg.HapticFeedback.notificationOccurred('warning');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initTelegramApp);
    </script>
</body>
</html>
